@page "{id:int}"
@model GocBep.Pages.Recipes.DetailsModel
@{
    ViewData["Title"] = Model.Recipe?.Name ?? "Chi Tiết Công Thức";
}

<h1>@ViewData["Title"]</h1>

@if (Model.Recipe == null)
{
    <p class="alert alert-warning">Không tìm thấy công thức bạn yêu cầu.</p>
}
else
{
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-8">
                @{
                    var imageUrl = !string.IsNullOrEmpty(Model.Recipe.ImageUrl) ? Url.Content(Model.Recipe.ImageUrl) : Url.Content("~/images/placeholder/default-recipe-image.png");
                }
                <img src="@imageUrl" alt="@Model.Recipe.Name" class="img-fluid rounded mb-3" style="max-height: 400px; width:100%; object-fit:cover;" />

                <h2 class="mb-3">@Model.Recipe.Name</h2>

                <p class="text-muted">
                    Đăng bởi: <strong>@(Model.Recipe.User?.UserName ?? "N/A")</strong> |
                    Ngày đăng: @Model.Recipe.CreatedAt.ToString("dd/MM/yyyy") |
                    Đánh giá: @Model.Recipe.AverageRating.ToString("0.0") <i class="fas fa-star text-warning"></i> (@(Model.Recipe.Ratings?.Count ?? 0) lượt)
                </p>

                @if (!string.IsNullOrEmpty(Model.Recipe.Description))
                {
                    <div class="recipe-section">
                        <h4>Mô tả</h4>
                        <p>@Html.Raw(Model.Recipe.Description.Replace("\n", "<br />"))</p>
                    </div>
                }

                <div class="recipe-section mt-4">
                    <h4><i class="fas fa-carrot"></i> Nguyên liệu</h4>
                    @if (!string.IsNullOrEmpty(Model.Recipe.Ingredients))
                    {
                        <ul class="list-group list-group-flush">
                            @foreach (var item in Model.Recipe.Ingredients.Split(new[] { '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries))
                            {
                                <li class="list-group-item">@item</li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p>Chưa có thông tin nguyên liệu.</p>
                    }
                </div>

                <div class="recipe-section mt-4">
                    <h4><i class="fas fa-utensils"></i> Hướng dẫn thực hiện</h4>
                    @if (!string.IsNullOrEmpty(Model.Recipe.Instructions))
                    {
                        <div class="instructions">
                            @Html.Raw(Model.Recipe.Instructions.Replace("\n", "<br />"))
                        </div>
                    }
                    else
                    {
                        <p>Chưa có thông tin hướng dẫn.</p>
                    }
                </div>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">Thông tin thêm</div>
                    <ul class="list-group list-group-flush">
                        @if (Model.Recipe.PrepTime.HasValue)
                        {
                            <li class="list-group-item"><strong><i class="far fa-clock"></i> Thời gian chuẩn bị:</strong> @Model.Recipe.PrepTime phút</li>
                        }
                        @if (Model.Recipe.CookTime.HasValue)
                        {
                            <li class="list-group-item"><strong><i class="fas fa-fire"></i> Thời gian nấu:</strong> @Model.Recipe.CookTime phút</li>
                        }
                        @if (Model.Recipe.Servings.HasValue)
                        {
                            <li class="list-group-item"><strong><i class="fas fa-users"></i> Khẩu phần:</strong> @Model.Recipe.Servings người</li>
                        }
                    </ul>
                </div>

                <div class="mt-3">
                    <h5>Đánh giá công thức này:</h5>
                    <p><em>(Chức năng đánh giá sẽ được cập nhật sau khi bạn đăng nhập)</em></p>
                    <button class="btn btn-outline-warning"><i class="far fa-heart"></i> Yêu thích</button>
                    <p><em>(Chức năng yêu thích sẽ được cập nhật sau khi bạn đăng nhập)</em></p>
                </div>

            </div>
        </div>

        <hr />
        <div class="mt-3">
            <a asp-page="/Index" class="btn btn-secondary">Quay lại Trang Chủ</a>
        </div>
    </div>
}